<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mindfullness Acitivity</title>
    <meta name="comp1800 template" content="My 1800 App">

    <!-- Bootstrap Library CSS CDN go here -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <!-- Firestore JS CDN  go here -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.js"></script>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    <!-- Boostrap Library JS CDN  go here -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous">
        </script>
    <!-- stylesheet from bootstrap-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
    <!-- stylesheet-->
    <link rel="stylesheet" href="/styles/style.css">

</head>

<style>
    .textAlign1 {
        margin-top: 3%;
        padding-bottom: 4%;
        font-size: 28px;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .list-group-item {
        text-align: center;
        font-weight: bold;
        margin-left: 32%;
    }

    .form-check {
        display: flex;
        align-items: flex-end;
        margin-bottom: 10px;
    }
</style>

<body>
    <!-- nav bar-->
    <script src="/scripts/navbar.js"></script>
    <div class="navbar-placeholder"></div>

    <!-- Header for choosing activity-->
    <h1 class="textAlign1"> Daily challenge</h1>

    <!-- Activity List-->

    <form id="myForm" class="list-group-item">
        <div class="form-check">
            <input class="form-check-input" type="checkbox" name="listGroupRadio"
                value="/mindfullness_activity/mnfn_walking.html" id="flexCheckChecked1" id="firstRadio">
            <label class="form-check-label" for="flexCheckChecked1">
                Mindful Walking
            </label>

        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" name="listGroupRadio"
                value="/mindfullness_activity/mnfn_adventure.html" id="flexCheckChecked2" id="secondRadio">
            <label class="form-check-label" for="flexCheckChecked2">
                Adventure new cafe & restaurant
            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" name="listGroupRadio"
                value="/mindfullness_activity/mnfn_painting.html" id="flexCheckChecked3" id="thirdRadio">
            <label class="form-check-label" for="flexCheckChecked3">
                Painting
            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" name="listGroupRadio"
                value="/mindfullness_activity/mnfn_photography.html" id="flexCheckChecked4" id="fourthRadio">
            <label class="form-check-label" for="flexCheckChecked4">
                Photography
            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" name="listGroupRadio"
                value="/mindfullness_activity/mnfn_cooking.html" id="flexCheckChecked5" id="fifthRadio">
            <label class="form-check-label" for="flexCheckChecked5">
                Cooking & Baking
            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" name="listGroupRadio"
                value="/mindfullness_activity/mnfn_reading.html" id="flexCheckChecked6" id="sixthRadio">
            <label class="form-check-label" for="flexCheckChecked6">
                Reading
            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" name="listGroupRadio"
                value="/mindfullness_activity/mnfn_exercise.html" id="flexCheckChecked7" id="seventhRadio">
            <label class="form-check-label" for="flexCheckChecked7">
                Exercise
            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" name="listGroupRadio"
                value="/mindfullness_activity/mnfn_puzzles.html" id="flexCheckChecked8" id="eighthRadio">
            <label class="form-check-label" for="flexCheckChecked8">
                Puzzles
            </label>
        </div>
        <!-- Have to make an website -->
        <div class="form-check">
            <input class="form-check-input" type="checkbox" name="listGroupRadio"
                value="/mindfullness_activity/mnfn_watching_movie.html" id="flexCheckChecked9" id="ninthRadio">
            <label class="form-check-label" for="flexCheckChecked9">
                Watching Movie
            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" name="listGroupRadio"
                value="/mindfullness_activity/mnfn_volunteer.html" id="flexCheckChecked10" id="tenthRadio">
            <label class="form-check-label" for="flexCheckChecked10">
                Volunteer
            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" name="listGroupRadio"
                value="/mindfullness_activity/mnfn_visit_family.html" id="flexCheckChecked11" id="eleventhRadio">
            <label class="form-check-label" for="flexCheckChecked11">
                Visit a family
            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" name="listGroupRadio"
                value="/mindfullness_activity/mnfn_meditation.html" id="flexCheckChecked12" id="twelfthRadio">
            <label class="form-check-label" for="flexCheckChecked12">
                Meditation
            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" name="listGroupRadio"
                value="/mindfullness_activity/mnfn_discover_music.html" id="flexCheckChecked13" id="thirteenthRadio">
            <label class="form-check-label" for="flexCheckChecked13">
                Discover favourite music
            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" name="listGroupRadio"
                value="/mindfullness_activity/mnfn_exhibition.html" id="flexCheckChecked14" id="fourteenthRadio">
            <label class="form-check-label" for="flexCheckChecked14">
                Exhibition
            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" name="listGroupRadio"
                value="/mindfullness_activity/mnfn_cleaning.html" id="flexCheckChecked15" id="fifteenthRadio">
            <label class="form-check-label" for="flexCheckChecked15">
                Cleaning
            </label>
        </div>
    </form>

    <br>
    <!-- Initiate activity button-->
    <div class="d-flex justify-content-center">
        <button type="button" class="btn btn-outline-secondary" id="lezChallenge">Let's challenge</button>
    </div>
    </form>

    <!-- footer -->

    <div class="footer-class"></div>

    <!-- JS connects to skeleton-->
    <script src="/scripts/FirebaseAPI.js"></script>
    <script src="/scripts/footer.js"></script>
    <script src="/scripts/skeleton.js"></script>
    <script>
        const activitiesInfo = {
            walking: { name: "Mindful Walking", url: "/mindfullness_activity/mnfn_walking.html" },
            adventure: { name: "Adventure new cafe & restaurant", url: "/mindfullness_activity/mnfn_adventure.html" },
            painting: { name: "Painting", url: "/mindfullness_activity/mnfn_painting.html" },
            photography: { name: "Photography", url: "/mindfullness_activity/mnfn_photography.html" },
            cooking: { name: "Cooking & Baking", url: "/mindfullness_activity/mnfn_cooking.html" },
            reading: { name: "Reading", url: "/mindfullness_activity/mnfn_reading.html" },
            exercise: { name: "Exercise", url: "/mindfullness_activity/mnfn_exercise.html" },
            puzzles: { name: "Puzzles", url: "/mindfullness_activity/mnfn_puzzles.html" },
            watching_movie: { name: "Watching Movie", url: "/mindfullness_activity/mnfn_watching_movie.html" },
            volunteer: { name: "Volunteer", url: "/mindfullness_activity/mnfn_volunteer.html" },
            visit_family: { name: "Visit a family", url: "/mindfullness_activity/mnfn_visit_family.html" },
            meditation: { name: "Meditation", url: "/mindfullness_activity/mnfn_meditation.html" },
            discover_music: { name: "Discover favourite music", url: "/mindfullness_activity/mnfn_discover_music.html" },
            exhibition: { name: "Exhibition", url: "/mindfullness_activity/mnfn_exhibition.html" },
            cleaning: { name: "Cleaning", url: "/mindfullness_activity/mnfn_cleaning.html" },
        };

        function handleSelection() {
            const checkboxes = document.querySelectorAll('input[name="listGroupRadio"]');
            const selectedActivities = Array.from(checkboxes).filter(checkbox => checkbox.checked);

            if (selectedActivities.length > 3) {
                alert('You can only select up to 3 activities.');
                return;
            }

            if (firebase.auth().currentUser) {
                const userId = firebase.auth().currentUser.uid;
                const userDocRef = db.collection('users').doc(userId);
                const activitiesCollectionRef = userDocRef.collection('activities');

                if (selectedActivities.length === 3) {
                    selectedActivities.forEach((activity, index) => {
                        // Extract activity key from the value attribute
                        const activityURL = new URL(activity.value, window.location.origin);
                        const pathSegments = activityURL.pathname.split('/');
                        const activityKey = pathSegments[pathSegments.length - 1].replace('.html', '').replace('mnfn_', '');

                        // Construct activity data object
                        const activityData = {
                            activityName: activitiesInfo[activityKey].name, // Get the name from activitiesInfo
                            status: "in progress",
                            timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                            url: activity.value // Store the URL for navigation
                        };

                        // Use the activity key as the document ID for direct mapping
                        activitiesCollectionRef.doc(activityKey).set(activityData)
                            .then(() => {
                                console.log(`Activity ${activityData.activityName} added/updated successfully.`);
                            })
                            .catch(error => {
                                console.error('Error adding/updating activity document:', error);
                            });
                    });
                    alert("Let's start it!");
                    window.location.href = '/main.html';
                } else {
                    alert('Please select exactly three activities to proceed.');
                }
            } else {
                alert('Please sign in to save your selections.');
            }
        }

        document.getElementById('lezChallenge').addEventListener('click', handleSelection);
    </script>
</body>

</html>
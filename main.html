<!DOCTYPE html>
<html lang="en">

<head>
    <title>Freely</title>
    <meta name="comp1800 template" content="My 1800 App">

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap Library CSS CDN go here -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <!-- Boostrap Library JS CDN  go here -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous">
        </script>

    <!-- Other libraries go here -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.js"></script>
    <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.css" />
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    <!-- Option 1: Include in HTML -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="./styles/style.css">


</head>
<style>
    .card-body {
        background-color: #eeca84;
        border-style: solid;
        border-width: 3px;
        border-color: white;
    }
</style>

<body>

    <!-- nav bar-->
    <script src="./scripts/navbar.js"></script>
    <div class="navbar-placeholder"></div>

    <!-- Welcome messsge-->
    <div class="px-4 py-5 my-5 text-center">
        <img class="rounded-image" src="./images/teamLogo.jpeg" alt="teamLogo" width="300" height="300">
        <h1 class="display-4">Good morning, <span id="name-goes-here"></span></h1>
        <div class="col-lg-6 mx-auto">

            <!-- where the quote is inputted from the firebase datastore -->
            <p><span id="quote-goes-here"></span> </p>
            <h2>Are you ready to tackle the day?</h2>
            <div class="card text-center">

                <div class="card-body">
                    <h5 class="card-title">Your Daily Challenges</h5>
                    <div id="challenge1"></div>
                    <div id="challenge2"></div>
                    <div id="challenge3"></div>
                    <a class="btn btn-primary" href="./mindfullness_activity/mnfn_activity_main.html"
                        id="challengesButton">Challenges</a>
                    <div class="d-flex justify-content-center">
                        <button type="button" class="btn btn-outline-secondary" id="submitBtn">Journal my day</button>
                    </div>
                </div>

            </div>
            </template>

        </div>
    </div>
    <!-- footer -->
    <div class="footer-class"></div>

    <!-- JS Functions-->
    <script src="./scripts/firebaseAPI.js"></script>
    <script src="./scripts/skeleton.js"></script>
    <script src="./scripts/main.js"></script>
    <script src="./scripts/footer.js"></script>
    <script>
        const activitiesInfo = {
            walking: { name: "Mindful Walking", url: "/mindfullness_activity/mnfn_walking.html" },
            adventure: { name: "Adventure new cafe & restaurant", url: "/mindfullness_activity/mnfn_adventure.html" },
            painting: { name: "Painting", url: "/mindfullness_activity/mnfn_painting.html" },
            photography: { name: "Photography", url: "/mindfullness_activity/mnfn_photography.html" },
            cooking: { name: "Cooking & Baking", url: "/mindfullness_activity/mnfn_cooking.html" },
            reading: { name: "Reading", url: "/mindfullness_activity/mnfn_reading.html" },
            exercise: { name: "Exercise", url: "/mindfullness_activity/mnfn_exercise.html" },
            puzzles: { name: "Puzzles", url: "/mindfullness_activity/mnfn_puzzles.html" },
            watching_movie: { name: "Watching Movie", url: "/mindfullness_activity/mnfn_watching_movie.html" },
            volunteer: { name: "Volunteer", url: "/mindfullness_activity/mnfn_volunteer.html" },
            visit_family: { name: "Visit a family", url: "/mindfullness_activity/mnfn_visit_family.html" },
            meditation: { name: "Meditation", url: "/mindfullness_activity/mnfn_meditation.html" },
            discover_music: { name: "Discover favourite music", url: "/mindfullness_activity/mnfn_discover_music.html" },
            exhibition: { name: "Exhibition", url: "/mindfullness_activity/mnfn_exhibition.html" },
            cleaning: { name: "Cleaning", url: "/mindfullness_activity/mnfn_cleaning.html" },
        };
        function fetchAndDisplayActivities() {
    firebase.auth().onAuthStateChanged(function(user) {
        if (user) {
            const userId = user.uid;
            const activitiesRef = db.collection('users').doc(userId).collection('activities').orderBy("timestamp", "desc").limit(3);

            activitiesRef.get().then(snapshot => {
                if (snapshot.empty) {
                    console.log('No activities found.');
                    return;
                }
                let allActivitiesCompleted = true;

                snapshot.docs.forEach((doc, index) => {
                    const data = doc.data();
                    const activityElement = document.getElementById(`challenge${index + 1}`);

                    if (activityElement) {
                        const activity = activitiesInfo[doc.id];
                        if (activity) {
                            let elementContent;

                            if (data.status === "completed") {
                                elementContent = `<span style="color: red;">${activity.name} - Completed</span>`;
                            } else if (data.status === "in progress") {
                                elementContent = `<a href="${activity.url}" style="color: orange;">${activity.name} - In Progress</a>`;
                                allActivitiesCompleted = false;
                            } else {
                                elementContent = `<a href="${activity.url}">${activity.name}</a>`;
                                allActivitiesCompleted = false;
                            }

                            activityElement.innerHTML = elementContent;
                        } else {
                            activityElement.innerHTML = "Activity not found";
                            allActivitiesCompleted = false;
                        }
                    }
                });
                const journalButton = document.getElementById('submitBtn');
                    if (allActivitiesCompleted) {
                        journalButton.style.display = 'block'; 
                        journalButton.addEventListener('click', function() {
                            window.location.href = './diary.html';
                        });
                    } else {
                        journalButton.style.display = 'none'; 
                    }
                document.getElementById('challengesButton').style.display = 'none';
            });
        } else {
            console.log("No user is signed in.");
        }
    });
}

window.onload = fetchAndDisplayActivities;
</script>
</body>

</html>